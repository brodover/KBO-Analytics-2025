<div class="stats-container">
  <h1>Pitcher Effectiveness (Windup vs. Stretch)</h1>

  <div class="filters">
    <label for="pitcherTeam">Filter by Pitcher Team:</label>
    <select id="pitcherTeam" [(ngModel)]="selectedPitcherTeam" (change)="applyFilters()">
      <option *ngFor="let team of uniquePitcherTeams" [value]="team">{{ team }}</option>
    </select>

    <label for="batterTeam">Filter by Batter Team:</label>
    <select id="batterTeam" [(ngModel)]="selectedBatterTeam" (change)="applyFilters()">
      <option *ngFor="let team of uniqueBatterTeams" [value]="team">{{ team }}</option>
    </select>
  </div>

  <table class="data-table">
    <thead>
      <tr>
        <th rowspan="2">Pitcher Team</th>
        <th rowspan="2">Batter Team</th>
        <th rowspan="2">Pitcher Name</th>
        <th rowspan="2">Pitch Type</th>
        <th colspan="4" class="windup-header">Windup (Bases Empty)</th>
        <th colspan="4" class="stretch-header">Stretch (Runners On)</th>
      </tr>
      <tr>
        <th>Pitches</th>
        <th>Swing Rate</th>
        <th>Contact Rate</th>

        <th>Pitches</th>
        <th>Swing Rate</th>
        <th>Contact Rate</th>
      </tr>
    </thead>
    <tbody>
      <tr 
        *ngFor="let stat of filteredStats; let i = index"
        [ngClass]="{'pitcher-divider': isNewPitcher(i)}">

        <td>{{ stat.pitcher_team_code }}</td>
        <td>{{ stat.batter_team_code }}</td>
        <td>{{ stat.pitcher_name }}</td>
        <td>{{ stat.pitch_type }}</td>

        <td class="pitch-count-cell">
          <div class="pitch-count-wrapper">
            <span class="pitch-number">{{ stat['pitches (windup)'] | number: '1.0-0' }}</span>

            <app-pitcher-stats-bars [totalPitches]="stat['pitches (windup)']" [swingRate]="stat['swing rate (windup)']"
              [contactRate]="stat['contact rate (windup)']"></app-pitcher-stats-bars>
          </div>
        </td>
        <td class="rate-column">{{ stat['swing rate (windup)'] | percent: '1.1-1' }}</td>
        <td class="rate-column">{{ stat['contact rate (windup)'] | percent: '1.1-1' }}</td>

        <td class="pitch-count-cell">
          <div class="pitch-count-wrapper">
            <span class="pitch-number">{{ stat['pitches (stretch)'] | number: '1.0-0' }}</span>

            <app-pitcher-stats-bars [totalPitches]="stat['pitches (stretch)']" [swingRate]="stat['swing rate (stretch)']"
              [contactRate]="stat['contact rate (stretch)']"></app-pitcher-stats-bars>
          </div>
        </td>
        <td class="rate-column">{{ stat['swing rate (stretch)'] | percent: '1.1-1' }}</td>
        <td class="rate-column">{{ stat['contact rate (stretch)'] | percent: '1.1-1' }}</td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="!filteredStats.length">
    No data found for the selected filters.
  </div>
</div>